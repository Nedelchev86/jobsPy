{% extends 'base.html' %}
{% load static %}
{% block main_content %}
    <!-- Start Breadcrumbs -->
    <div class="breadcrumbs overlay">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="breadcrumbs-content">
                        <h1 class="page-title">Blog Single</h1>
                        <p>Business plan draws on a wide range of knowledge from different business<br> disciplines.
                            Business draws on a wide range of different business .</p>
                    </div>
                    <ul class="breadcrumb-nav">
                        <li><a href="{% url 'index' %}">Home</a></li>
                        <li>Blog Single</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- End Breadcrumbs -->

    <!-- Start Blog Singel Area -->
    <section class="section blog-single">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 offset-lg-1 col-12">
                    <div  id="single-post" class="single-inner">
                        <h3>Loading...</h3>
                    </div>
                        <div class="post-comments">
                            <form id="comment-form">
    <textarea id="comment-content" rows="4" cols="50" placeholder="Write your comment here..."></textarea>
    <button type="submit">Post Comment</button>
                                {% csrf_token %}
</form>
                                <h3 class="comment-title"><span>3 comments on this post</span></h3>
                                <ul id="comments-list" class="comments-list">
                                </ul>
                            </div>
                </div>
            </div>

        </div>

    </section>
       <script src="{% static '/js/blog/blog_detail.js' %}"></script>

{#   <script src="{% static '/js/blog/post_comment.js' %}"></script>#}
    <script>
    document.addEventListener('DOMContentLoaded', function () {
    const commentForm = document.getElementById('comment-form');

    commentForm.addEventListener('submit', function (event) {
        event.preventDefault();

        // Get the comment content from the form
        const content = document.getElementById('comment-content').value;
            const blogPostId = window.location.pathname.split('/')[2]



        // Send the comment data to the backend
        postComment(content);
    });
});

function postComment(content) {
    const blogPostId = window.location.pathname.split('/')[2]
         const csrfToken = "{{ csrf_token }}";
         console.log(csrfToken)
    // AJAX request to post the comment
    fetch(`/api/blog/${blogPostId}/comments/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
               'X-CSRFToken':  csrfToken,
            // Add any required authentication headers if needed
        },
        body: JSON.stringify({ content: content }),
    })
    .then(response => response.json())
    .then(data => {
        // Comment successfully posted, update UI
        console.log('Comment posted:', data);
        // You can update the UI to display the new comment here
    })
    .catch(error => {
        console.error('Error posting comment:', error);
    });
}
    </script>

   <script src="{% static '/js/blog/load_comment.js' %}"></script>


{% endblock %}